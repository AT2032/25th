# 要求定義
要求は上から順に優先。フライトデータの取得が最低なのは飛ぶことを優先するためである
* システムの要求  
  1．パイロットの操作でラダーを制御する  
  2．プラットホーム上で姿勢を確認する  
  3．パイロットに対地高度・対気速度を伝達する  
  4．フライトデータを取得する
* 電装班運営の要求  
  1．必要な技術を継承する

# 要件定義
## 共通事項
### 非機能要件
* 信頼性
  * 故障による直接的な機能の喪失は認めるが，優先度が低いものが故障が高いものに影響を与えないような設計にする
    * 無線通信が混信しても他に影響を与えない
    * メイン電装のマイコンが停止しても操舵系は機能を維持する
    * SDカードが脱落しても他の機能は動作する
  * ソフトウェアのバグ，コクピフレームとの接触による短絡，通信線の切断などの故障を想定する
  * システムが複雑になるため基本的に冗長は組まず，予備部品の用意で対応する
* 安全性
  * 着水時に発煙・発火しない
  * パイロットの頭部付近に電装を配置しない(今年はピトー管がカウルの上部にあるが，パイロットの頭部であるキャノピーまで伸ばさないように長さを調節した)
* 稼働時間
  * 着水までバッテリーが持つ
    * 電圧の監視が可能である
    * リポバッテリーが取り外しできるように電装ハッチを作る
* 環境
  * 機体が直射日光にあたり温度が上昇しても動作する
  * 多少の水滴では故障せず動作し続ける
  * (直射日光下で)LEDを見る必要なく運用できる
  * トラックで輸送する際，振動や熱に耐えられる
  * 機体の金属やCFRPの粉，琵琶湖の砂の対策がされている
* 運用
  * プラットフォーム上で電装の電源を起動できる
  * プラホ上での電装作業を最小限にする
* 開発環境・メンテナンス
  * 琵琶湖で機体を組んだ状態で電装のプログラムを変更できる
  * デバッグに必要な情報をなるべく多く出力する
* 拡張性
  * 他のセンサや基盤を新たに作成したい場合に備えてUARTをたくさん使えるマイコン(ラズピコ)を使う
### 制約条件
* 電気的制約
  * SPIは通信速度が速く，I2Cはプルアップが不安定なため基板内のみで使用
  * 基板間の通信はUART
  * マイコンの動作電圧は基本3.3V
* 技術的制約
  * Arduinoを使用し，自力でライブラリを書かなくてよい構成とする(これは電子工作の経験者がいない場合でも製作ができるように)
  * UARTによる文字列送受信を行う
  * チップ部品は使用しない(表面実装などは現在の鳥科の技術力では厳しい→ちゃんと引継ぎできるのであればやってみてもいいかも)
  * ケーブルの圧着はせず，既製品を使用する(かなりの技術力がいり，難しいため)
## 操舵
鳥科ではずっとフライバイワイヤーを使っており，いきなりノウハウがないワイヤーリンケージを使うのは飛行に影響がある可能性があるため，ノウハウがあるフライバイワイヤーでラダーを動かす
* パイロットの操作でラダーを制御する
  * 入力を読む
    * アナログ入力を読むため，ジョイスティックまたは可変抵抗を使用する
    * 不感帯を含む，任意のカーブを設定できる
  * サーボモーターを動かす
    * 十分なトルクがある
      * 風対策
    * 信号・電力の減衰が起きない
      * ケーブルが断線しない
      * ケーブルの電圧降下が小さい
      * テールまでの長いケーブルで問題なく信号伝達できる
* その他の要件
  * トラブル時ニュートラルでフライトできる(これは機構側で担保)
  * プログラムを変更せずに琵琶湖でニュートラル調整が可能である(操舵範囲は事前調整)
  * テールを軽くする(今年はそこまで軽量化を求められたわけではないが歴代で使ってきたサーボの信頼性とバッテリーの取り出しやすさの面から下のようにした)
    * バッテリーはコクピに搭載
    * 軽量なサーボを使用
  * 機体内通信を含む，無線通信で操舵を行ってはならない(大会ルール)
## テレメトリ
* プラホからの発進時に姿勢などを確認できるようにする
* 受信機はポケットに入る程度のサイズにする
  * PC・タブレットは大きくてプラットフォームで扱いづらい(特に雨天時)
* デバッグのため，全センサーデータをダウンリンクする
## 高度速度計
* パイロットに対地高度・対気速度を伝達する
  * 対地個黄土を推定する
    * 測定精度は0.1m単位を要求
    * 技術的な制約
      * 高高度では気圧高度を，低高度では超音波高度を信用すべき
        * 気圧高度は湖面からの絶対高度は分からない
        * 超音波は(ほとんどのセンサーで)高高度からでは届かない
      * 気圧センサ
        * 動圧・ハッチの衝撃によるセンサーの外れ値を弾く(LOGを整理する際に行う，プログラム内には組み込まない(重くなるため))
        * 中央値を取るために違う場所に3つの気圧センサーを配置する
      * 超音波センサ
        * 水面付近は気圧高度より信用できる
  * 対気速度を測定する
    * 記録方法は後述
  * パイロットに情報を伝達する
    * 四角は前方に集中するのでモニター等は使えない
    * 触角は操縦に影響するので使えない
    * 使えるのは聴覚のみ
  * その他の要件
    * センサーデータが取得できない場合，以上だと検知した場合は読み上げを行わない
## ロガー
* 下記のデータを記録する

| 優先度     | 測定値 | 備考  |
| ---      | ---       | ---      |
| 高 | GPS         | ある程度信頼できるため冗長の必要はない  |
| 高 | 超音波高度   | 超音波が干渉するため一つだけ搭載する    |
| 高 | 気圧高度　   | 高度計の信頼性を確保できる分だけ搭載する |
| 中 | ラダー操作量 | ラダー操作に影響を与えないように    |
| 中 | 9軸・姿勢   | プラホ上でも姿勢の値が見れるように    |
| 中 | 対気速度   | 様々な測定方法がある    |
| 中 | AoS・滑り角   | 代替手段がない　今年はピトー管にベーンを取り付けるため，それで測定を行う    |
| 低 | AoA・迎角   | 水面付近は上下方向の風は基本なく，ピッチの測定値と同じになる    |


  
